(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{Dsyz:function(e,t,a){e.exports={container:"antd-pro-pages-article-edit-container",richEditor:"antd-pro-pages-article-edit-richEditor",smallItem:"antd-pro-pages-article-edit-smallItem",middleItem:"antd-pro-pages-article-edit-middleItem"}},XASQ:function(e,t,a){"use strict";a.r(t);a("+L6B");var l,n,i,r,s=a("2/Rp"),o=(a("iQDF"),a("+eQT")),m=(a("BoS7"),a("Sdc0")),c=(a("2qtc"),a("kLXV")),d=(a("DZo9"),a("8z0m")),u=(a("sRBo"),a("kaz8")),p=(a("giR+"),a("fyUT")),h=a("jehZ"),g=a.n(h),E=(a("miYZ"),a("tsqr")),y=(a("Pwec"),a("CtXQ")),v=a("d6i3"),f=a.n(v),b=a("1l/V"),w=a.n(b),I=a("p0pE"),B=a.n(I),k=a("2Taf"),V=a.n(k),L=a("vZ4D"),N=a.n(L),S=a("l4Ni"),C=a.n(S),x=a("ujKo"),D=a.n(x),_=a("MhPg"),M=a.n(_),Y=(a("y8nQ"),a("Vl3Y")),z=(a("7Kak"),a("9yH6")),T=(a("OaEy"),a("2fM7")),H=(a("Znn+"),a("ZTPi")),P=(a("5NDa"),a("5rEg")),R=a("q1tI"),q=a.n(R),O=a("MuoO"),Z=a("Dsyz"),j=a.n(Z),U=a("zHco"),A=a("yEr3"),F=a.n(A),Q=(a("Lzxq"),a("wd/R")),X=a.n(Q),J=(a("XDpg"),a("Z0Lh")),K=a.n(J);X.a.locale("zh-cn");var G=P["a"].TextArea,W=H["a"].TabPane,$=T["a"].Option,ee=z["a"].Group,te=(l=Object(O["connect"])(function(e){var t=e.model;return{model:t}}),n=Y["a"].create(),l(i=n((r=function(e){function t(){var e,a;V()(this,t);for(var l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];return a=C()(this,(e=D()(t)).call.apply(e,[this].concat(n))),a.modelName="article",a.state={msg:"",url:"",previewVisible:!1,previewImage:"",coverList:[],data:{categorys:[],file_id:null,file_name:null,file_path:null},status:"",pagination:{},loading:!1},a.handleCancel=function(){return a.setState({previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){t.id=a.state.data.id,t.created_at=t.created_at.format("YYYY-MM-DD HH:mm:ss"),t.content=a.state.data.content;var l=[];a.state.coverList.map(function(e){l.push(e.uid)}),t.cover_ids=JSON.stringify(l),e||a.props.dispatch({type:"model/save",payload:B()({modelName:a.modelName},t)})})},a.submitContent=w()(f.a.mark(function e(){return f.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a.state.content.toHTML();case 1:case"end":return e.stop()}},e)})),a.handleEditorChange=function(e){a.state.data.content=e.toHTML()},a.handleEditorUpload=function(e){var t="/api/admin/picture/upload",a=new XMLHttpRequest,l=new FormData,n=function(t){var l=JSON.parse(a.responseText);"success"===l.status?e.success({url:l.data.url,meta:{id:l.data.id,title:l.data.title,alt:l.data.title,loop:!0,autoPlay:!0,controls:!0,poster:l.data.url}}):e.error({msg:l.msg})},i=function(t){e.progress(t.loaded/t.total*100)},r=function(t){e.error({msg:"unable to upload."})};a.upload.addEventListener("progress",i,!1),a.addEventListener("load",n,!1),a.addEventListener("error",r,!1),a.addEventListener("abort",r,!1),l.append("file",e.file),a.open("POST",t,!0),a.setRequestHeader("Authorization","Bearer "+sessionStorage["token"]),a.send(l)},a}return M()(t,e),N()(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({loading:!0});var t=this.props.location.query;this.props.dispatch({type:"model/edit",payload:B()({modelName:this.modelName},t),callback:function(t){t&&(t.data.content=F.a.createEditorState(t.data.content),e.setState({data:t.data,coverList:t.data.cover_list,loading:!1}),console.log(e.state.data))}})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a={labelCol:{xs:{span:24},sm:{span:2}},wrapperCol:{xs:{span:24},sm:{span:22}}},l=q.a.createElement("div",null,q.a.createElement(y["a"],{type:"plus"}),q.a.createElement("div",{className:"ant-upload-text"},"\u4e0a\u4f20\u56fe\u7247")),n={name:"file",listType:"picture-card",fileList:this.state.coverList,onPreview:function(t){e.setState({previewImage:t.url||t.thumbUrl,previewVisible:!0})},action:"/api/admin/picture/upload",headers:{authorization:"Bearer "+sessionStorage["token"]},beforeUpload:function(e){if("image/jpeg"!==e.type&&"image/png"!==e.type)return E["a"].error("\u8bf7\u4e0a\u4f20jpg\u6216png\u683c\u5f0f\u7684\u56fe\u7247!"),!1;var t=e.size/1024/1024<2;return!!t||(E["a"].error("\u56fe\u7247\u5927\u5c0f\u4e0d\u53ef\u8d85\u8fc72MB!"),!1)},onChange:function(t){var a=t.fileList;a=a.slice(-3),a=a.map(function(e){return e.response&&(e.url=e.response.data.url,e.uid=e.response.data.id),e}),a=a.filter(function(e){return!e.response||"success"===e.response.status}),e.setState({coverList:a})}},i={name:"file",action:"/api/admin/file/upload",headers:{authorization:"Bearer "+sessionStorage["token"]},onChange:function(e){"uploading"!==e.file.status&&console.log(e.file,e.fileList),"done"===e.file.status?E["a"].success("".concat(e.file.name," \u4e0a\u4f20\u6210\u529f\uff01")):"error"===e.file.status&&E["a"].error("".concat(e.file.name," \u4e0a\u4f20\u5931\u8d25\uff01"))}};return q.a.createElement(U["a"],null,q.a.createElement("div",{className:j.a.container},q.a.createElement(Y["a"],{onSubmit:this.handleSubmit},q.a.createElement(H["a"],{defaultActiveKey:"1",tabBarExtraContent:q.a.createElement("a",{href:"javascript:history.go(-1)"},"\u8fd4\u56de\u4e0a\u4e00\u9875\xa0\xa0\xa0\xa0")},q.a.createElement(W,{tab:"\u57fa\u672c",key:"1"},q.a.createElement(Y["a"].Item,g()({style:{marginBottom:0}},a,{label:"\u6807\u9898"}),q.a.createElement(Y["a"].Item,{style:{display:"inline-block",marginBottom:8}},t("title",{initialValue:this.state.data.title},{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6807\u9898\uff01"}]})(q.a.createElement(P["a"],{className:j.a.middleItem,placeholder:"\u8bf7\u8f93\u5165\u6807\u9898"}))),q.a.createElement(Y["a"].Item,{style:{display:"inline-block",marginBottom:8,marginLeft:10}},"\u7b80\u7565\u6807\u9898\uff1a",t("name",{initialValue:this.state.data.name})(q.a.createElement(P["a"],{className:j.a.smallItem,placeholder:"\u8bf7\u8f93\u5165\u7b80\u7565\u6807\u9898"})))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u63cf\u8ff0"}),t("description",{initialValue:this.state.data.description})(q.a.createElement(G,{className:j.a.middleItem,placeholder:"\u8bf7\u8f93\u5165\u63cf\u8ff0",autosize:{minRows:3,maxRows:6}}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u6807\u7b7e"}),t("tags",{initialValue:this.state.data.tags})(q.a.createElement(P["a"],{className:j.a.middleItem,placeholder:"\u8bf7\u8f93\u5165\u6807\u7b7e",autosize:{minRows:3,maxRows:6}}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:0}},a,{label:"\u4f5c\u8005"}),q.a.createElement(Y["a"].Item,{style:{display:"inline-block",marginBottom:8}},t("author",{initialValue:this.state.data.author})(q.a.createElement(P["a"],{className:j.a.smallItem,placeholder:"\u8bf7\u8f93\u5165\u4f5c\u8005"}))),q.a.createElement(Y["a"].Item,{style:{display:"inline-block",marginBottom:8,marginLeft:10}},"\u6765\u6e90\uff1a",t("source",{initialValue:this.state.data.source})(q.a.createElement(P["a"],{className:j.a.smallItem,placeholder:"\u8bf7\u8f93\u5165\u6765\u6e90"}))),q.a.createElement(Y["a"].Item,{style:{display:"inline-block",marginBottom:8,marginLeft:10}},"\u6392\u5e8f\uff1a",t("level",{initialValue:this.state.data.level},{rules:[{type:"number",message:"\u5fc5\u987b\u4e3a\u6570\u5b57"}]})(q.a.createElement(p["a"],{min:0,max:1e5}))," (\u8d8a\u5927\u8d8a\u9760\u524d)")),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u63a8\u8350\u4f4d"}),t("position",{initialValue:this.state.data.position})(q.a.createElement(u["a"].Group,{style:{width:"100%"}},q.a.createElement(u["a"],{value:1},"\u9996\u9875\u63a8\u8350"),q.a.createElement(u["a"],{value:2},"\u9891\u9053\u63a8\u8350"),q.a.createElement(u["a"],{value:4},"\u5217\u8868\u63a8\u8350"),q.a.createElement(u["a"],{value:8},"\u8be6\u60c5\u63a8\u8350")))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u5c55\u73b0\u5f62\u5f0f"}),t("show_type",{initialValue:this.state.data.show_type})(q.a.createElement(ee,null,q.a.createElement(z["a"],{value:1},"\u65e0\u56fe"),q.a.createElement(z["a"],{value:2},"\u5355\u56fe\uff08\u5c0f\uff09"),q.a.createElement(z["a"],{value:3},"\u591a\u56fe"),q.a.createElement(z["a"],{value:4},"\u5355\u56fe\uff08\u5927\uff09")))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u5c01\u9762\u56fe"}),q.a.createElement(d["a"],n,this.state.coverList>=3?null:l),q.a.createElement(c["a"],{visible:this.state.previewVisible,footer:null,onCancel:this.handleCancel},q.a.createElement("img",{style:{width:"100%"},src:this.state.previewImage}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u5206\u7c7b"}),t("category_id",{initialValue:this.state.data.category_id?this.state.data.category_id.toString():void 0},{rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u5206\u7c7b\uff01"}]})(q.a.createElement(T["a"],{style:{width:200},placeholder:"\u9009\u62e9\u5206\u7c7b"},0!==this.state.data.categorys.length?this.state.data.categorys.map(function(e){return q.a.createElement($,{key:e.id},e.title)}):console.log("select data null")))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u5141\u8bb8\u8bc4\u8bba"}),t("comment_status",{initialValue:"open"===this.state.data.comment_status,valuePropName:"checked"})(q.a.createElement(m["a"],{checkedChildren:"\u662f",unCheckedChildren:"\u5426"}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u5185\u5bb9"}),q.a.createElement("div",{className:j.a.richEditor},q.a.createElement(F.a,{value:this.state.data.content,onChange:this.handleEditorChange,onSave:this.submitContent,contentStyle:{height:400,boxShadow:"inset 0 1px 3px rgba(0,0,0,.1)"},media:{uploadFn:this.handleEditorUpload}}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u53d1\u5e03\u65f6\u95f4"}),t("created_at",{initialValue:X()(this.state.data.created_at,"YYYY-MM-DD HH:mm:ss")})(q.a.createElement(o["a"],{showTime:!0,locale:K.a,format:"YYYY-MM-DD HH:mm:ss",placeholder:"\u8bf7\u9009\u62e9\u65f6\u95f4"})))),q.a.createElement(W,{tab:"\u6269\u5c55",key:"2"},q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u8bc4\u8bba\u91cf"}),t("comment",{initialValue:this.state.data.comment})(q.a.createElement(p["a"],{className:j.a.smallItem,min:0,max:1e5}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u6d4f\u89c8\u91cf"}),t("view",{initialValue:this.state.data.view})(q.a.createElement(p["a"],{className:j.a.smallItem,min:0,max:1e5}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u8bbf\u95ee\u5bc6\u7801"}),t("password",{initialValue:this.state.data.password})(q.a.createElement(P["a"],{className:j.a.smallItem,placeholder:"\u8bf7\u8f93\u5165\u8bbf\u95ee\u5bc6\u7801"}))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u9644\u4ef6"}),q.a.createElement(d["a"],i,q.a.createElement(s["a"],null,q.a.createElement(y["a"],{type:"upload"})," \u4e0a\u4f20\u9644\u4ef6"))))),q.a.createElement(Y["a"].Item,g()({style:{marginBottom:8}},a,{label:"\u72b6\u6001"}),t("status",{initialValue:1===this.state.data.status,valuePropName:"checked"})(q.a.createElement(m["a"],{checkedChildren:"\u6b63\u5e38",unCheckedChildren:"\u7981\u7528"}))),q.a.createElement(Y["a"].Item,{wrapperCol:{span:12,offset:5}},q.a.createElement(s["a"],{type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))))}}]),t}(R["PureComponent"]),i=r))||i)||i);t["default"]=te}}]);